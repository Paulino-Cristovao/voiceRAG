# ğŸ™ï¸ Voice RAG - Assistente de Voz com IA

Sistema de atendimento ao cliente com voz usando RAG (Retrieval-Augmented Generation) com **LangChain**, permitindo conversas naturais sobre serviÃ§os da empresa atravÃ©s de voz.

**Empresa:** MozaitelecomunicaÃ§Ã£o (exemplo)
**Idioma:** PortuguÃªs de MoÃ§ambique

---

## âœ¨ Funcionalidades

âœ… **Sem AutenticaÃ§Ã£o** - Qualquer usuÃ¡rio pode fazer perguntas imediatamente
âœ… **MemÃ³ria de Conversa** - Lembra os Ãºltimos 10 intercÃ¢mbios para contexto
âœ… **LangChain RAG** - Sistema aprimorado com melhor precisÃ£o
âœ… **Base de Conhecimento** - Respostas apenas da documentaÃ§Ã£o PDF
âœ… **Filtro de Profanidade** - Bloqueia linguagem inapropriada
âœ… **InterrupÃ§Ã£o** - Pode parar o AI e fazer nova pergunta
âœ… **Voz Bidirecional** - Entrada por voz (Whisper) e saÃ­da por voz (TTS)
âœ… **WebSocket Real-time** - ComunicaÃ§Ã£o instantÃ¢nea

---

## ğŸ—ï¸ Arquitetura

```
User (Voice)
    â†“
Whisper (STT)
    â†“
LangChain RAG + Memory
    â†“
FAISS Vector Search â†’ PDF Knowledge Base
    â†“
GPT-4o-mini (Answer)
    â†“
TTS (Voice)
    â†“
User (Voice)
```

**Tech Stack:**
- **Backend:** FastAPI + WebSocket
- **RAG:** LangChain + FAISS
- **AI:** OpenAI (Whisper, GPT-4o-mini, TTS-1)
- **Frontend:** Vanilla JS + HTML/CSS
- **Vector DB:** FAISS (text-embedding-3-large, 3072 dims)

---

## ğŸ“‹ Requisitos

- Python 3.10+
- Navegador moderno (Chrome, Firefox, Safari 14+)
- Microfone e alto-falantes
- OpenAI API Key

---

## ğŸš€ InstalaÃ§Ã£o

### 1. Clonar RepositÃ³rio

```bash
git clone git@github.com:Paulino-Cristovao/voiceRAG.git
cd voiceRAG
```

### 2. Criar Ambiente Virtual

```bash
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
```

### 3. Instalar DependÃªncias

```bash
pip install -r requirements.txt
```

### 4. Configurar API Key

```bash
cp .env.example .env
# Edit .env and add your OpenAI API key:
# OPENAI_API_KEY=sk-your-key-here
```

### 5. Verificar Dados

```bash
# Check knowledge base is indexed
ls data/index.faiss data/metadata.pkl

# If missing, rebuild index:
python ingest_pdfs.py
```

### 6. Iniciar Servidor

```bash
python app.py
# or
./start.sh
```

### 7. Abrir no Navegador

```
http://localhost:8000
```

**Permitir acesso ao microfone quando solicitado!**

---

## ğŸ“ Estrutura do Projeto

```
voiceRAG/
â”œâ”€â”€ app.py                    # Main application (LangChain RAG)
â”œâ”€â”€ ingest_pdfs.py           # Build FAISS index from PDFs
â”œâ”€â”€ requirements.txt         # Python dependencies
â”œâ”€â”€ start.sh                 # Startup script
â”œâ”€â”€ .env.example             # Environment template
â”œâ”€â”€ .gitignore              # Git exclusions
â”‚
â”œâ”€â”€ static/                  # Frontend
â”‚   â”œâ”€â”€ index.html          # Main interface
â”‚   â”œâ”€â”€ diagnostic.html     # Browser/mic testing
â”‚   â””â”€â”€ favicon.svg         # Icon
â”‚
â”œâ”€â”€ data/                    # Vector database (generated)
â”‚   â”œâ”€â”€ index.faiss         # FAISS vector index
â”‚   â””â”€â”€ metadata.pkl        # Chunk metadata
â”‚
â””â”€â”€ pdfs/                    # Knowledge base source
    â”œâ”€â”€ sample_support.txt  # Main documentation
    â””â”€â”€ *.pdf              # Additional PDFs
```

**Note:** The `data/` folder is generated by `ingest_pdfs.py` from PDFs.

---

## ğŸ¯ Como Usar

### Primeira Vez

1. Abra `http://localhost:8000`
2. Clique no cÃ­rculo do microfone (permite acesso)
3. Sistema saÃºda: "OlÃ¡! Bem-vindo Ã  MozaitelecomunicaÃ§Ã£o..."
4. Clique no microfone e faÃ§a sua pergunta (5 segundos)
5. AI responde com voz

### ConversaÃ§Ã£o

```
VocÃª: "Quanto custa o plano Premium 5G?"
AI: "O plano Premium 5G custa 1.500 MZN/mÃªs..."

VocÃª: "E qual vocÃª recomenda para um estudante?"
AI: "Para estudante, recomendo o Plano BÃ¡sico 4G, 500 MZN/mÃªs..." âœ…
     ^ Lembra o contexto da pergunta anterior!
```

### Interromper

- Enquanto AI fala, clique no botÃ£o **"ğŸ›‘ Interromper"**
- Ãudio para imediatamente
- Pode fazer nova pergunta

---

## ğŸ”§ ConfiguraÃ§Ã£o AvanÃ§ada

### VariÃ¡veis de Ambiente (.env)

```bash
OPENAI_API_KEY=sk-your-key-here
EMBEDDING_MODEL=text-embedding-3-large  # or text-embedding-3-small
CHAT_MODEL=gpt-4o-mini                  # or gpt-4o
TOP_K=5                                  # Number of chunks to retrieve
```

### Adicionar DocumentaÃ§Ã£o

```bash
# 1. Adicione PDFs ou TXT em pdfs/
cp your_docs.pdf pdfs/

# 2. Reconstrua o Ã­ndice FAISS
python ingest_pdfs.py

# 3. Reinicie o servidor
python app.py
```

---

## ğŸ§ª Testes

### Teste RÃ¡pido (2 minutos)

```
1. "Quais sÃ£o os vossos serviÃ§os?"
   â†’ Deve listar serviÃ§os da empresa

2. "Quanto custa o Premium 5G?"
   â†’ "1.500 MZN/mÃªs"

3. "E qual recomenda para estudante?"
   â†’ Deve recomendar plano (lembra contexto!) âœ…

4. "Qual Ã© o email de apoio?"
   â†’ "apoio@mozaitelecomunicacao.co.mz"

5. "Qual Ã© o tempo hoje?"
   â†’ Deve rejeitar e redirecionar para suporte
```

### DiagnÃ³stico

Abra `http://localhost:8000/diagnostic` para testar:
- Suporte do navegador
- Acesso ao microfone
- WebSocket
- ReproduÃ§Ã£o de Ã¡udio

---

## ğŸ› Troubleshooting

### Microfone nÃ£o funciona

**Problema:** "Seu navegador nÃ£o suporta gravaÃ§Ã£o de Ã¡udio"

**SoluÃ§Ãµes:**
1. Use `http://localhost:8000` (nÃ£o IP address)
2. Chrome: ğŸ”’ â†’ Microfone â†’ Permitir
3. Safari: PreferÃªncias â†’ Sites â†’ Microfone â†’ Permitir
4. Teste em outro navegador (Chrome 60+, Firefox 55+, Safari 14+)

### Servidor nÃ£o inicia

**Problema:** "Address already in use"

```bash
# Matar processo na porta 8000
lsof -ti:8000 | xargs kill -9

# Reiniciar
python app.py
```

### Respostas incorretas

**Problema:** AI nÃ£o encontra informaÃ§Ã£o que estÃ¡ no PDF

```bash
# Reconstruir Ã­ndice FAISS
python ingest_pdfs.py

# Verificar chunks criados
# Should see: "Created X chunks"

# Reiniciar
python app.py
```

### Sem memÃ³ria de conversa

**Problema:** AI nÃ£o lembra pergunta anterior

**VerificaÃ§Ã£o:**
1. Logs devem mostrar: `ğŸ’¬ History: X messages`
2. Se mostrar `ğŸ’¬ History: 0 messages` sempre, hÃ¡ problema
3. Verifique estÃ¡ usando a versÃ£o LangChain:
   ```bash
   head -5 app.py
   # Deve conter: "from langchain_openai import"
   ```

---

## ğŸ’° Custos (OpenAI API)

| OperaÃ§Ã£o | Custo por Query |
|----------|----------------|
| Embedding (search) | ~$0.00013 |
| GPT-4o-mini (answer) | ~$0.0001-0.0002 |
| Whisper (STT) | ~$0.0006 |
| TTS-1 (voice) | ~$0.00015 |
| **Total** | **~$0.001 per query** |

**Mensal (1000 queries):** ~$1.00/mÃªs

---

## ğŸ“Š Performance

| MÃ©trica | Valor |
|---------|-------|
| Tempo de resposta | 2-4 segundos |
| DimensÃµes vetoriais | 3072 (text-embedding-3-large) |
| MemÃ³ria de conversa | 10 Ãºltimas trocas |
| PrecisÃ£o (testes) | 100% (4/4 queries) |
| Chunks na base | VariÃ¡vel (depende dos PDFs) |

---

## ğŸ” SeguranÃ§a

- âœ… Filtro de profanidade (portuguÃªs + inglÃªs)
- âœ… ValidaÃ§Ã£o de entrada
- âœ… Respostas apenas da base de conhecimento
- âœ… Redirecionamento para suporte em casos sensÃ­veis
- âš ï¸ **NÃ£o usar .env em produÃ§Ã£o** (usar secrets manager)
- âš ï¸ **Adicionar rate limiting** para produÃ§Ã£o

---

## ğŸš€ Deploy em ProduÃ§Ã£o

### RecomendaÃ§Ãµes:

1. **HTTPS obrigatÃ³rio** (microfone requer conexÃ£o segura)
2. **Rate limiting** (prevenir abuso)
3. **Logging estruturado** (monitoring)
4. **Secrets management** (nÃ£o usar .env)
5. **Load balancer** (se mÃºltiplas instÃ¢ncias)

### Exemplo Docker:

```dockerfile
FROM python:3.10-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["python", "app.py"]
```

---

## ğŸ“š DocumentaÃ§Ã£o Adicional

- **LANGCHAIN_UPGRADE.md** - Detalhes da integraÃ§Ã£o LangChain + resultados de testes
- **.env.example** - Exemplo de configuraÃ§Ã£o
- **static/diagnostic.html** - PÃ¡gina de diagnÃ³stico

---

## ğŸ¤ Contribuir

1. Fork o repositÃ³rio
2. Crie branch: `git checkout -b feature/nova-funcionalidade`
3. Commit: `git commit -m 'Add nova funcionalidade'`
4. Push: `git push origin feature/nova-funcionalidade`
5. Abra Pull Request

---

## ğŸ“„ LicenÃ§a

MIT License - Veja LICENSE file para detalhes

---

## ğŸ™ CrÃ©ditos

- **OpenAI** - Whisper, GPT-4o-mini, TTS, Embeddings
- **LangChain** - RAG framework
- **FAISS** - Vector search (Facebook AI)
- **FastAPI** - Web framework

---

## ğŸ“ Suporte

**GitHub Issues:** https://github.com/Paulino-Cristovao/voiceRAG/issues

**Email:** (adicione seu email aqui)

---

**Desenvolvido com Claude Code** ğŸ¤–
